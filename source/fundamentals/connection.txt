================
Connection Guide
================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

This guide shows you how to connect to a MongoDB instance or replica set
deployment using the Go Driver.

--------------
Connection URI
--------------

The **connection URI** provides the set of instructions that the driver uses to
connect to a MongoDB deployment. It instructs the driver on how it should
connect to MongoDB and how it should behave while connected. The following
image explains each part of a sample connection URI:

.. figure:: /includes/figures/connection_string_parts.png
   :alt: Each part of the connection string

In this example, we use ``mongodb+srv`` for the protocol, which specifies the
:manual:`DNS Seedlist Connection Format
</reference/connection-string/#dns-seedlist-connection-format>`. This indicates
that the URI's hostname corresponds to the DNS SRV record of your
MongoDB instance or deployment. If your instance or deployment does not have a
DNS SRV record, use ``mongodb`` to specify the :manual:`Standard Connection
Format </reference/connection-string/#standard-connection-string-format>`.

.. note::

   If your deployment is on MongoDB Atlas, see the
   :atlas:`Atlas driver connection guide </driver-connection>`
   and select Go from the language dropdown to retrieve your connection string.

The next part of the connection string contains your username and, if
you are using password-based authentication, your password. Replace the value of
``user`` with your username and ``pass`` with your password. If you are using an
authentication mechanism that does not require a username and password, omit
this section of the connection URI.

The next part of the connection string specifies the hostname or IP address and
port of your MongoDB instance. In the example above, we use ``sample-hostname``
as the hostname and ``27017``, the default port, as the port. Replace these values to point to
your MongoDB instance.

The last part of the connection string specifies connection and authentication
options. In the example, we set two connection options:
``poolSize=20`` and ``writeConcern=majority``. For more information on connection
options, read the :ref:`connection-options` section of this guide.

The code below shows how you can use the sample connection URI in a client to
connect to MongoDB.

.. literalinclude:: /includes/fundamentals/code-snippets/srv.go
   :language: go

Connect to ``localhost``
++++++++++++++++++++++++

.. include:: /includes/localhost-connection.rst

------------------------
Connect to a Replica Set
------------------------

A MongoDB replica set deployment is a group of connected instances that
store the same set of data. This configuration provides data
redundancy and high data availability.

To connect to a replica set deployment, specify the hostname and port numbers
of each instance, separated by commas, and the replica set name as the value
of the ``replicaSet`` parameter in the connection string. In the following
example, the replica set name is ``myRS``.

.. code-block:: none

   mongodb://host1:27017,host2:27017,host3:27017/?replicaSet=myRS

When connecting to a replica set, the driver takes the following actions by default:

- Discovers all replica set members when given the address of any one member.
- Dispatches operations to the appropriate member, such as a directive
  to write against the **primary**.

.. tip::

   You only need to specify one host to connect to a replica set. However, to ensure connectivity if the specified host
   is unavailable, you should provide the full list of hosts.

Direct Connection
+++++++++++++++++

To force operations on the host designated in the connection URI, specify the ``directConnection`` option. Direct
connections:

- Don't support SRV strings.
- Fail on writes when the specified host is not the **primary**.
- Require you to :manual:`enable secondary reads </reference/method/rs.secondaryOk/>`
  when the specified host isn't the **primary**.

.. _connection-options:

------------------
Connection Options
------------------

This section explains several common MongoDB connection and authentication
options. You can pass the connection options as parameters of the connection
URI to specify the behavior of the client.

.. list-table::
   :header-rows: 1
   :widths: 25 10 15 40

   * - Option Name
     - Type
     - Default Value
     - Description

   * - **connectTimeoutMS**
     - integer
     - ``30000``
     - Specifies the number of milliseconds to wait before timeout on a TCP
       connection.

   * - **maxPoolSize**
     - integer
     - ``100``
     - Specifies the maximum number of connections that a connection pool may
       have at a given time.

   * - **maxIdleTimeMS**
     - integer
     - ``0``
     - Specifies the maximum amount of time a connection can remain idle
       in the connection pool before being removed and closed.

   * - **minPoolSize**
     - integer
     - ``0``
     - Specifies the minimum number of connections that must exist at any moment
       in a single connection pool.

   * - **socketTimeoutMS**
     - integer
     - ``0``
     - Specifies the number of milliseconds to wait to find an
       available, suitable server to execute an operation.

   * - **serverSelectionTimeoutMS**
     - integer
     - ``30000``
     - Specifies the number of milliseconds to wait before timeout on a TCP
       socket.

   * - **heartbeatIntervalMS**
     - integer
     - ``0``
     - Specifies the number of milliseconds to wait between periodic
       background server checks.

   * - **tls**
     - boolean
     - ``false``
     - Specifies whether to establish a Transport Layer Security (TLS)
       connection with the instance. This is automatically set to ``true``
       when using a DNS seedlist (SRV) in the connection string. You can
       override this behavior by setting the value to ``false``.

   * - **writeConcern**
     - string or integer
     - ``null``
     - Specifies the write concern. For more information on values, see the
       server documentation on
       :manual:`Write Concern options </reference/write-concern>`.

   * - **directConnection**
     - boolean
     - ``false``
     - Specifies whether to force dispatch **all** operations to the host
       specified in the connection URI.
